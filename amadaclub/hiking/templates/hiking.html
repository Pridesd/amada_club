{% extends 'base.html'%}
{%block content%}
    <!-- 컨텐츠 화면 -->

    <div class="main_photo main_hiking">
    </div>
    <main class="main_contents">
        <div class="title">Hiking</div>
        <div class="hiking_info">
            <div class="hiking_article">
                <span class="subtitle underline korean">산악 소식</span>
                <div class="hiking_news korean">
                    <span><i class="far fa-sad-cry"></i></span>
                    준비중입니다ㅜ
                </div>
            </div>
            <div class="hiking_article">
                <span class="subtitle underline korean">산악 기상</span>
                <div class="hiking_weather korean">
                    <!-- <label for="location">지역 선택</label>
                    <select name="location" id="">
                        <option>지역을 선택해주세요</option>
                        <option value="01">서울특별시</option>
                        <option value="02">세종특별자치시</option>
                        <option value="03">부산광역시</option>
                        <option value="04">대구광역시</option>
                        <option value="05">광주광역시</option>
                        <option value="06">인천광역시</option>
                        <option value="07">대전광역시</option>
                        <option value="08">울산광역시</option>
                        <option value="09">경기도</option>
                        <option value="10">강원도</option>
                        <option value="11">충청남도</option>
                        <option value="12">충청북도</option>
                        <option value="13">전라남도</option>
                        <option value="14">전라북도</option>
                        <option value="15">경상남도</option>
                        <option value="16">경상북도</option>
                        <option value="17">제주도</option>
                    </select>
                    <label for="mountains">산 선택</label>
                    <select name="mountains" id="">
                        <option>산을 선택해주세요</option>
                    </select> -->
                    {%for key, value in weather.items %}
                        {%if key == '서울 수락산'%}
                            <p>{{key}}기온: {{value.temp}}</p>
                        {%endif%}
                    {%endfor%}
                    <div id="map" style="width: 500px; height: 400px; z-index: 0;">
                    </div>
                    <!-- <span><i class="far fa-sad-cry"></i></span>
                    준비중입니다ㅜ -->
                </div>
            </div>
        </div>
        <div class="hiking_article">
            <span class="subtitle underline korean">산행 기록</span>
            <div class="hiking_memory korean">
                <span><i class="far fa-sad-cry"></i></span>
                준비중입니다ㅜ
            </div>
        </div>
    </main>
    <script src="/static/js/kakaomap.js"></script>
    <script>
        var address = JSON.parse("{{ location|escapejs }}");
        var weather = JSON.parse("{{ weather|escapejs }}");
        // console.log(address[0].mountain);
        // 마커를 표시할 위치입니다 
        var positions =  [];
        var markerArray = [];
        for(var i = 0; i < Object.keys(address).length; i++){
                var content = {
                    title: address[i].mountain,
                    latlng: new kakao.maps.LatLng(address[i].mapy, address[i].mapx),
                    temp: weather[i].temp,
                    humanity: weather[i].humanity,
                    wind:weather[i].wind,
                    rain:weather[i].rain
                }
                positions.push(content);
        };

        
        for (var i = 0; i < positions.length; i++) {            
            // 마커를 생성합니다
            var marker = new kakao.maps.Marker({
                map: map, // 마커를 표시할 지도
                position: positions[i].latlng, // 마커를 표시할 위치
                title: positions[i].title, // 마커의 타이틀, 마커에 마우스를 올리면 타이틀이 표시됩니다
        });
        markerArray.push(marker);

        (function(marker, place) {
            // 마크 클릭 시
            kakao.maps.event.addListener(marker, 'click', function() {
                var overlay = new kakao.maps.CustomOverlay({
                // 오버레이에 띄울 내용
                content: '<div class="map_wrap">' +
                        '    <div class="map_info">' +
                        '        <div class="map_title">' +
                                    place.title +
                        '        </div>' +
                        '        <div class="map_body">' +
                        '            <div class="map_desc">' +
                        '                <div class="map_ellipsis">' + '기온: ' + place.temp + '</div>' +
                        '		       <div class="map_ellipsis">'+ '습도: ' + place.humanity + '%' + '</div>' +
                        '		       <div class="map_ellipsis">'+ '풍속: ' + place.wind + 'm/s' +'</div>' +
                        '		       <div class="map_ellipsis">'+ '강수량: ' + place.rain + 'mm' +'</div>' +
                        '            </div>' +
                        '        </div>' +
                        '    </div>' +
                        '</div>',
                map: map,
                position: marker.getPosition()
                });
                // 아무데나 클릭하게되면 overlay를 끄기
                kakao.maps.event.addListener(map, 'click', function(mouseEvent) {
                overlay.setMap(null)
                })
                console.log(overlay);
                overlay.setMap(map);
            })
            })(marker, positions[i])
        }
        var changeMarkerImage = function(){				
				// 지도의 현재 레벨을 얻어옵니다
				var level = map.getLevel();
                
                // 마커 이미지의 이미지 주소입니다
                var imageSrc = "/static/img/아마다.png";
				// 지도 크기 레벨 별로 마커 사이즈를 조절 합니다
				if(1 <= level && level <= 4) {
					markerImage = new kakao.maps.MarkerImage(imageSrc, new kakao.maps.Size(70, 73));
				} 
                else if(5 <= level && level <= 7) {
					markerImage = new kakao.maps.MarkerImage(imageSrc, new kakao.maps.Size(50, 53));
				} 
                else if(8 <= level && level <= 11) {
                    markerImage = new kakao.maps.MarkerImage(imageSrc, new kakao.maps.Size(30, 33));
				} 
                else if(12 <= level) {
					markerImage = new kakao.maps.MarkerImage(imageSrc, new kakao.maps.Size(10, 13));
				} 
                for(var i = 0; i < markerArray.length; i++){
				    markerArray[i].setImage(markerImage);
                }
			};
			
		kakao.maps.event.addListener(map, 'zoom_changed', changeMarkerImage);
		changeMarkerImage();
    </script>
    
    <!-- 컨텐츠 화면 종료 -->
{%endblock%}